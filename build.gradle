plugins {
    id "idea"
    id "io.github.gradle-nexus.publish-plugin" version "2.0.0"
}

group = 'com.vertexvis'
version = '0.11.0'

allprojects {
    group = 'com.vertexvis'
    version = project.hasProperty('isSnapshot') && project.isSnapshot.toBoolean() ? 
        '0.11.0-SNAPSHOT' : '0.11.0'
    
    repositories {
        mavenCentral()
        maven {
            name = "GitHubPackages"
            url = uri("https://maven.pkg.github.com/Vertexvis/vertex-api-client-java")
            credentials {
                username = System.getenv("GITHUB_ACTOR") ?: project.findProperty("gpr.user") ?: ""
                password = System.getenv("GITHUB_TOKEN") ?: project.findProperty("gpr.key") ?: ""
            }
        }
    }
}

subprojects {
    apply plugin: 'java-library'
    
    java {
        toolchain {
            languageVersion.set(JavaLanguageVersion.of(17))
        }
    }
    
    test {
        useJUnitPlatform()
        testLogging {
            events "passed", "skipped", "failed"
        }
    }
}

nexusPublishing {
    repositories(
        sonatype()
    )
    repositories {
        sonatype {
            nexusUrl.set(uri("https://ossrh-staging-api.central.sonatype.com/service/local/"))
            snapshotRepositoryUrl.set(uri("https://central.sonatype.com/repository/maven-snapshots/"))
            username = project.hasProperty("ossrhUsername") ? project.ossrhUsername : ""
            password = project.hasProperty("ossrhPassword") ? project.ossrhPassword : ""
        }
    }
}

def base64Decode(prop) {
    return new String(Base64.getDecoder().decode(project.findProperty(prop).toString())).trim()
}
